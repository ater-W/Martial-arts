<!doctype html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>每日武术视频</title>
    <style>
        :root{
            --bg:#0f1720; --card:#0b1220; --muted:#9aa4b2; --accent:#ffb86b;
            --maxw:1000px;
        }
        *{box-sizing:border-box}
        body{
            margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
            background:linear-gradient(180deg,#071025 0%, #071827 60%); color:#e6eef6;
            display:flex; align-items:center; justify-content:center; min-height:100vh; padding:32px;
        }
        .wrap{width:100%; max-width:var(--maxw);}
        header{display:flex;align-items:center;gap:16px;margin-bottom:18px}
        header h1{margin:0;font-size:20px;letter-spacing:0.6px}
        header .date{color:var(--muted); font-size:13px}
        .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent); padding:18px;border-radius:12px;box-shadow:0 6px 30px rgba(2,6,23,0.6)}
        .player-row{display:grid;grid-template-columns:1fr 320px;gap:16px}
        video{width:100%; height:100%; max-height:60vh; background:#000; border-radius:8px; outline:none}
        .info{padding:8px 6px}
        .title{font-size:18px;margin:6px 0 2px}
        .desc{color:var(--muted); font-size:13px; margin:0 0 8px}
        .controls{display:flex;gap:8px;flex-wrap:wrap}
        button{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--accent);padding:8px 10px;border-radius:8px;cursor:pointer}
        button.secondary{color:var(--muted); border-color:rgba(255,255,255,0.03)}
        .playlist{display:grid; gap:10px; padding:6px; max-height:60vh; overflow:auto}
        .item{display:flex;gap:8px;align-items:center;padding:6px;border-radius:8px;cursor:pointer}
        .thumb{width:84px;height:48px;flex-shrink:0;background:#111;border-radius:6px;object-fit:cover}
        .meta{font-size:13px}
        .meta .t{color:#fff}
        .meta .s{color:var(--muted); font-size:12px}
        footer{margin-top:12px;color:var(--muted); font-size:13px; text-align:center}
        @media (max-width:880px){
            .player-row{grid-template-columns:1fr}
            .playlist{display:flex;overflow-x:auto}
            .item{min-width:220px}
        }
    </style>
</head>
<body>
    <div class="wrap">
        <header>
            <div>
                <h1>每日武术视频</h1>
                <div class="date" id="todayLabel"></div>
            </div>
        </header>

        <div class="card">
            <div class="player-row">
                <div>
                    <!-- HTML5 视频播放器，支持本地 mp4/webm。也可以替换为 iframe 嵌入（YouTube） -->
                    <video id="player" controls preload="metadata" poster="">
                        <!-- 若要直接引用网络视频，可在这里添加 <source> 标签或在 JS 中设置 src -->
                        您的浏览器不支持 HTML5 视频。
                    </video>

                    <div class="info">
                        <div class="title" id="vTitle">加载中…</div>
                        <div class="desc" id="vDesc">请选择一个视频或等待今日推送。</div>

                        <div class="controls" style="margin-top:8px">
                            <button id="prevBtn" class="secondary">上一个</button>
                            <button id="nextBtn" class="secondary">下一个</button>
                            <button id="todayBtn">今日播放</button>
                            <button id="toggleAuto" class="secondary">自动播放：开</button>
                            <a id="downloadLink" class="secondary" style="text-decoration:none" download>下载</a>
                        </div>
                    </div>
                </div>

                <aside>
                    <div style="font-size:14px;margin-bottom:8px;color:var(--muted)">播放列表</div>
                    <div class="playlist" id="playlist"></div>
                </aside>
            </div>
        </div>

        <footer>提示：把视频文件放在与本页面相同的文件夹下（例如 videos/wushu1.mp4），并在脚本里添加条目。</footer>
    </div>

    <script>
        // 视频列表：把 src 指向你本地或可访问的视频文件（mp4/webm）。poster 为封面缩略图（可选）。
        const videos = [
            { id: 'w1', title: '泰拳拜师舞',  src: 'videos/泰拳拜师舞.mp4', poster: 'images/泰拳拜师舞.png' },
            { id: 'w2', title: '印尼班卡西拉（Pencak Silat）的“步法艺术”',src: 'videos/印尼班卡西拉（Pencak Silat）的“步法艺术”.mp4', poster: 'images/印尼班卡西拉（Pencak Silat）的“步法艺术”.png' },
            { id: 'w3', title: '越南越武道剪刀腿',  src: 'videos/越南越武道剪刀腿.mp4', poster: 'images/越南越武道剪刀腿.png' },
            { id: 'w4', title: '泰拳的起源',  src: 'videos/泰拳的起源.mp4', poster: 'images/泰拳的起源.png' },
        ];

        const player = document.getElementById('player');
        const vTitle = document.getElementById('vTitle');
        const vDesc = document.getElementById('vDesc');
        const playlistEl = document.getElementById('playlist');
        const todayLabel = document.getElementById('todayLabel');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const todayBtn = document.getElementById('todayBtn');
        const toggleAuto = document.getElementById('toggleAuto');
        const downloadLink = document.getElementById('downloadLink');

        let currentIndex = 0;
        let autoplay = true;

        function formatDate(d){ return d.toLocaleDateString(); }
        function dailyIndex(){
            // 按天轮换：把当天（日序号）映射到数组索引
            const day = new Date().getDate(); // 1..31
            return (day - 1) % videos.length;
        }

        function loadVideo(i, autoPlayNow = false){
            const v = videos[i];
            if(!v) return;
            currentIndex = i;
            // 更新 video src：使用 blob/local URL 或直接设置 src
            player.pause();
            player.src = v.src;
            player.poster = v.poster || '';
            vTitle.textContent = v.title;
            vDesc.textContent = v.desc;
            downloadLink.href = v.src;
            downloadLink.setAttribute('download', v.title.replace(/\s+/g,'_') + '.mp4');
            highlightPlaylistItem();
            // 记录今日已播放的索引（与日期一起）
            localStorage.setItem('lastWatchedIndex', i);
            localStorage.setItem('lastWatchedDate', new Date().toDateString());
            if(autoplay && autoPlayNow) player.play().catch(()=>{});
        }

        function highlightPlaylistItem(){
            Array.from(playlistEl.children).forEach((el, idx)=>{
                el.style.background = idx === currentIndex ? 'linear-gradient(90deg, rgba(255,184,107,0.12), transparent)' : 'transparent';
            });
        }

        function buildPlaylist(){
            playlistEl.innerHTML = '';
            videos.forEach((v, idx)=>{
                const it = document.createElement('div');
                it.className = 'item';
                it.innerHTML = `
                    <img class="thumb" src="${v.poster || ''}" alt="" onerror="this.style.background='#111'">
                    <div class="meta">
                        <div class="t">${v.title}</div>
                        <div class="s">${v.desc}</div>
                    </div>
                `;
                it.onclick = ()=> loadVideo(idx, true);
                playlistEl.appendChild(it);
            });
        }

        prevBtn.onclick = ()=> loadVideo((currentIndex - 1 + videos.length) % videos.length, true);
        nextBtn.onclick = ()=> loadVideo((currentIndex + 1) % videos.length, true);
        todayBtn.onclick = ()=> loadVideo(dailyIndex(), true);
        toggleAuto.onclick = ()=>{
            autoplay = !autoplay;
            toggleAuto.textContent = '自动播放：' + (autoplay ? '开' : '关');
        };

        // 自动播放下一个（当 current video 结束）
        player.addEventListener('ended', ()=> {
            if(autoplay) loadVideo((currentIndex + 1) % videos.length, true);
        });

        // 启动：显示日期，构建列表，选择初始视频（优先：当天记录 -> 今日推送）
        (function init(){
            const today = new Date();
            todayLabel.textContent = '今日：' + today.toLocaleDateString();
            buildPlaylist();

            const savedDate = localStorage.getItem('lastWatchedDate');
            const savedIndex = Number(localStorage.getItem('lastWatchedIndex'));
            if(savedDate === today.toDateString() && !Number.isNaN(savedIndex)){
                loadVideo(savedIndex, false);
            } else {
                loadVideo(dailyIndex(), false);
            }

            // 如果设备不允许自动播放，开关仍可控制手动播放
            player.addEventListener('canplay', ()=> { /* 可扩展 */ });
        })();
    </script>
</body>
</html>